import j from"./VInputBase-385a360a.mjs";import D from"./TimeView-3b8f694a.mjs";import G from"./TimelineCursor-fd82d273.mjs";import H from"./ScaleScroll-1ce2705b.mjs";import{a as Q,c as U}from"./useTimeline-80d07c57.mjs";import{a as $,Q as q,b as g,r as h,a1 as J,w as A,G as W,u as r,o as d,f as c,h as v,F as x,H as b,i as _,I as B,j as X,t as Y,c as Z}from"./entry-29da48b6.mjs";import{a as ee}from"./usePixPerSec-ba71fbb2.mjs";import te from"./KeyframeMarker-ae242d4b.mjs";import ae from"./KeyframeSelectRect-43f5f719.mjs";import"./onDragStart-b67a33ef.mjs";import"./useKeyboard-f4963c17.mjs";const le={style:{height:"100%","border-right":"solid 1px white"}},ne=v("div",{style:{"border-bottom":"1px solid",height:"20px"}}," Properties ",-1),oe={style:{width:"200px",height:"100%"}},re={style:{margin:"auto 4px"}},se={style:{position:"relative",height:"calc(100% - 12px)"}},ie={style:{display:"flex",position:"relative",height:"20px","border-bottom":"1px solid"}},ue={style:{position:"absolute",bottom:"0",width:"100%"}},we=$({__name:"KeyframePanel",setup(de){const{timeline:y,updateEffect:V,update:I}=Q(),{addEventListener:L}=q(),t=g(()=>y.value.selectedStrips.length>0?y.value.selectedStrips[0]:null),u=h(new Map),K=h(new Map),T=g(()=>{var l;let e=p.value,n=1;for(;e<30;)n=n*2,e=p.value*n;if(!t.value)return[];const o=Math.ceil((m.value-s.value)*(((l=t.value)==null?void 0:l.length)||0)),a=s.value*t.value.length*p.value;return[...Array(o)].map((f,i)=>i*n*p.value-a%(n*p.value))}),s=h(0),m=h(1);function z(){var o;u.value.clear(),(o=t.value)==null||o.effects.forEach(a=>{"animations"in a&&a.animations.forEach(l=>{var f;u.value.has(l.key)||u.value.set(l.key,[]),K.value.set(l.id,{...a}),(f=u.value.get(l.key))==null||f.push(l)})});const e=new Map,n=[...u.value.keys()];n.sort((a,l)=>a.localeCompare(l)),n.forEach(a=>{e.set(a,u.value.get(a)||[])}),u.value=e}const w=h(null),p=g(()=>{var e;return ee(w.value,(m.value-s.value)*(((e=t.value)==null?void 0:e.length)||0))});function k(){F()}J(k);const E=h(0);function F(){var o;if(!t.value){E.value=0;return}const e=(o=w.value)==null?void 0:o.getBoundingClientRect(),n=(e==null?void 0:e.width)||0;E.value=-n*s.value/(m.value-s.value)}g(()=>t.value?t.value.length:0),A(t,()=>{z()}),A(()=>{var e;return[...((e=t.value)==null?void 0:e.effects)||[]]},()=>{z()});const C=h(null);W(()=>{var e;L("resize",k),window.addEventListener("resize",k),(e=C.value)==null||e.addEventListener("keydown",n=>{!t.value||n.key==="x"&&t.value.effects.filter(o=>{if("animations"in o){const a=[];o.animations.forEach(l=>{y.value.selectedKeyframes.forEach(f=>{l.id!==f.id&&a.push({...l})}),t.value&&V(t.value.id,{...o,animations:a})})}return!0})})});function N(e){s.value=e}function O(e){m.value=e}function R(e){!t.value||I(t.value.start+e,!0)}return(e,n)=>{const o=j,a=D,l=G,f=H;return r(t)?(d(),c("div",{key:0,ref_key:"el",ref:C,style:{display:"flex",height:"100%"}},[v("div",le,[ne,v("div",oe,[(d(!0),c(x,null,b(u.value,(i,S)=>(d(),c("div",{key:S,style:{display:"flex",overflow:"hidden",height:"20px","white-space":"nowrap","box-sizing":"border-box","border-bottom":"1px solid var(--border-grey)"}},[v("div",re,Y(i[0])+": ",1),_(o,{style:{margin:"2px 4px 2px auto"},value:r(U)(i[1],r(y).curent-r(t).start,i[0],0).toFixed(3),readonly:""},null,8,["value"])]))),128))])]),v("div",{ref_key:"timeArea",ref:w,style:{overflow:"hidden",position:"relative",width:"100%",height:"100%","user-select":"none"}},[v("div",se,[_(ae),v("div",ie,[_(a,{start:s.value*r(t).length,length:(m.value-s.value)*r(t).length,onMove:R},null,8,["start","length"])]),_(l,{style:B({left:(r(y).curent-r(t).start-s.value*r(t).length)*r(p)+"px"})},null,8,["style"]),(d(!0),c(x,null,b(r(T),i=>(d(),c("div",{key:i,style:B([{left:`${i}px`},{display:"flex",position:"absolute",height:"100%","border-left":"1px solid var(--bg2)"}])},null,4))),128)),(d(!0),c(x,null,b(u.value,(i,S)=>(d(),c("div",{key:S,style:{dislplay:"flex",position:"relative",height:"24px",width:"100%","border-bottom":"1px solid var(--bg2)","box-sizing":"border-box"}},[(d(!0),c(x,null,b(i[1],M=>{var P;return d(),Z(te,{key:M.id,animation:M,scale:r(p),left:E.value,effect:K.value.get(M.id),"strip-id":((P=r(t))==null?void 0:P.id)||""},null,8,["animation","scale","left","effect","strip-id"])}),128))]))),128))]),v("div",ue,[_(f,{start:s.value,end:m.value,onStart:N,onEnd:O},null,8,["start","end"])])],512)],512)):X("",!0)}}});export{we as default};
