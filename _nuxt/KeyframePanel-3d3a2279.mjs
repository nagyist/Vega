import H from"./VInputBase-e3014785.mjs";import J from"./TimeView-2a59e67a.mjs";import U from"./TimelineCursor-1528ca51.mjs";import $ from"./ScaleScroll-ea2ea90a.mjs";import{a as q,e as G,H as Q,f as M,r as c,T as W,w as T,x as X,u as i,o as s,i as v,j as p,F as x,y as w,k as _,z as A,l as Y,t as Z,J as ee,c as te}from"./entry-5722d099.mjs";import ae from"./KeyframeMarker-05a2cebf.mjs";import oe from"./KeyframeSelectRect-362fe4b4.mjs";import"./usePixPerSec-cdc6a4f2.mjs";import"./onDragStart-b67a33ef.mjs";import"./useKeyboard-ea2bfea0.mjs";const le={style:{height:"100%","border-right":"solid 1px white"}},ne=p("div",{style:{"border-bottom":"1px solid",height:"20px"}}," Properties ",-1),ie={style:{width:"200px",height:"100%"}},re={style:{margin:"auto 4px"}},se={style:{position:"relative",height:"calc(100% - 12px)"}},ue={style:{display:"flex",position:"relative",height:"20px","border-bottom":"1px solid"}},de={style:{position:"absolute",bottom:"0",width:"100%"}},be=q({__name:"KeyframePanel",setup(ce){const{timeline:h,updateEffect:P,update:V}=G(),{addEventListener:L}=Q(),t=M(()=>h.value.selectedStrips.length>0?h.value.selectedStrips[0]:null),r=c(new Map),z=c(new Map),F=M(()=>[...Array(Math.floor(R.value))].map((e,n)=>n)),u=c(0),m=c(1);function C(){var a;r.value.clear(),(a=t.value)==null||a.effects.forEach(o=>{"animations"in o&&o.animations.forEach(l=>{var f;r.value.has(l.key)||r.value.set(l.key,[]),z.value.set(l.id,{...o}),(f=r.value.get(l.key))==null||f.push(l)})});const e=new Map,n=[...r.value.keys()];n.sort((o,l)=>o.localeCompare(l)),n.forEach(o=>{e.set(o,r.value.get(o)||[])}),r.value=e}const b=c(null),y=c(0);function I(){var a;if(!t.value){y.value=1;return}const e=(a=b.value)==null?void 0:a.getBoundingClientRect(),n=(e==null?void 0:e.width)||0;y.value=n/t.value.length/(m.value-u.value)}function k(){I(),N()}W(k);const g=c(0);function N(){var a;if(!t.value){g.value=0;return}const e=(a=b.value)==null?void 0:a.getBoundingClientRect(),n=(e==null?void 0:e.width)||0;g.value=-n*u.value/(m.value-u.value)}const R=M(()=>t.value?t.value.length:0);T(t,()=>{C()}),T(()=>{var e;return[...((e=t.value)==null?void 0:e.effects)||[]]},()=>{C()});const K=c(null);X(()=>{var e;L("resize",k),window.addEventListener("resize",k),(e=K.value)==null||e.addEventListener("keydown",n=>{!t.value||n.key==="x"&&t.value.effects.filter(a=>{if("animations"in a){const o=[];a.animations.forEach(l=>{h.value.selectedKeyframes.forEach(f=>{l.id!==f.id&&o.push({...l})}),t.value&&P(t.value.id,{...a,animations:o})})}return!0})})});function O(e){u.value=e}function j(e){m.value=e}function D(e){!t.value||V(t.value.start+e,!0)}return(e,n)=>{const a=H,o=J,l=U,f=$;return i(t)?(s(),v("div",{key:0,ref_key:"el",ref:K,style:{display:"flex",height:"100%"}},[p("div",le,[ne,p("div",ie,[(s(!0),v(x,null,w(r.value,(d,E)=>(s(),v("div",{key:E,style:{display:"flex",overflow:"hidden",height:"20px","white-space":"nowrap","box-sizing":"border-box","border-bottom":"1px solid var(--border-grey)"}},[p("div",re,Z(d[0])+": ",1),_(a,{style:{margin:"2px 4px 2px auto"},value:i(ee)(d[1],i(h).curent-i(t).start,d[0],0).toFixed(3),readonly:""},null,8,["value"])]))),128))])]),p("div",{ref_key:"timeArea",ref:b,style:{overflow:"hidden",position:"relative",width:"100%",height:"100%","user-select":"none"}},[p("div",se,[_(oe),p("div",ue,[_(o,{start:u.value*i(t).length,length:(m.value-u.value)*i(t).length,onMove:D},null,8,["start","length"])]),_(l,{style:A({left:(i(h).curent-i(t).start-u.value*i(t).length)*y.value+"px"})},null,8,["style"]),(s(!0),v(x,null,w(i(F),d=>(s(),v("div",{key:d,style:A([{left:`${g.value+d*y.value}px`},{display:"flex",position:"absolute",height:"100%","border-left":"1px solid var(--bg2)"}])},null,4))),128)),(s(!0),v(x,null,w(r.value,(d,E)=>(s(),v("div",{key:E,style:{dislplay:"flex",position:"relative",height:"24px",width:"100%","border-bottom":"1px solid var(--bg2)","box-sizing":"border-box"}},[(s(!0),v(x,null,w(d[1],S=>{var B;return s(),te(ae,{key:S.id,animation:S,scale:y.value,left:g.value,effect:z.value.get(S.id),"strip-id":((B=i(t))==null?void 0:B.id)||""},null,8,["animation","scale","left","effect","strip-id"])}),128))]))),128))]),p("div",de,[_(f,{start:u.value,end:m.value,onStart:O,onEnd:j},null,8,["start","end"])])],512)],512)):Y("",!0)}}});export{be as default};
