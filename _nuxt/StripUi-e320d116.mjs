import{p as z,a as F,e as W,r as k,f as T,o as O,i as q,c as A,v as K,j as E,C as D,u as U,L as X,a2 as Y,N as G}from"./entry-6cd864d6.mjs";import{u as Q}from"./useOperation-8bb78d10.mjs";import{u as Z}from"./useKeyboard-44b65f00.mjs";import{u as tt}from"./usePixPerSec-6b3dd217.mjs";import{c as et}from"./clone-0e5b969a.mjs";import{o as b}from"./onDragStart-b67a33ef.mjs";const st=["id"],rt=F({__name:"StripUi",props:{strip:{type:Object,required:!0},top:{default:0,type:Number}},setup(w){const t=w,{timeline:l,moveStrip:o,selectStrip:C}=W(),{pushHistory:m}=Q(),{keyboard:M}=Z(),N=50,h=k(null),a=T(()=>{var e;return tt((e=h.value)==null?void 0:e.parentElement)}),y=50,g=28,_=k(0),H=T(()=>{let e=(t.strip.start-l.value.start)*a.value,s=t.strip.length*a.value;return e<-y&&(s+=e+y,e=-y),s<=g?(_.value=g-s,s=g):_.value=0,{width:s+"px",position:"absolute",top:t.strip.layer*N+1-t.top+"px",left:e+"px"}}),S=k(!1);function J(e){var c;e.preventDefault(),e.stopPropagation();const s=(c=h.value)==null?void 0:c.parentElement,i=s==null?void 0:s.getBoundingClientRect();if(!i)return;const n={start:t.strip.start,length:t.strip.length,id:t.strip.id,layer:t.strip.layer},d=n.start;let r={...n},p=l.value.selectedStrips.filter(f=>f.id!==t.strip.id);const u=p.map(f=>et(f));S.value=!0,b(e,(f,$,I)=>{l.value.selectedStrips.find(v=>v.id===t.strip.id)||(M.value.shift||(p=[]),P(t.strip)),S.value=!1;const x=Math.floor(($.clientY-i.top+t.top)/N);x<0||(r={id:n.id,layer:x,start:d+I.x/a.value,length:n.length},o(r.id,r.start,r.length,r.layer),p.forEach((v,B)=>{const j=-n.layer+u[B].layer;o(v.id,u[B].start+I.x/a.value,v.length,x+j)}))},()=>{if(S.value){P(t.strip);return}m(`MoveStrip: ${JSON.stringify(r,null,2)}`),Y.push(()=>{m(`Undo MoveStrip: ${JSON.stringify(n,null,2)}`),o(n.id,n.start,n.length,n.layer)},()=>{m(`Redo MoveStrip: ${JSON.stringify(r,null,2)}`),o(r.id,r.start,r.length,r.layer)})})}function L(e){e.stopPropagation();const s=t.strip.start+t.strip.length,i=t.strip.start,n=t.strip.length;b(e,(d,r,p)=>{const u=G(p.x/a.value),c=i+u;c>s||o(t.strip.id,c,n-u,t.strip.layer)})}function R(e){e.stopPropagation();const s=t.strip.length;b(e,(i,n,d)=>{const r=s+d.x/a.value;r<0||o(t.strip.id,t.strip.start,r)})}function V(e){for(let s=0;s<e.effects.length;s++){const i=e.effects[s];if(i.type==="Text")return"panels-text-strip-ui";if(i.type==="Video")return"panels-video-strip-ui";if(i.type==="Audio")return"panels-audio-strip-ui";if(i.type==="Image")return"panels-image-strip-ui";console.warn("unknown effect type",i.type)}}function P(e){M.value.shift?C(l.value.selectedStrips.map(s=>s.id).concat([e.id])):C([e.id])}return(e,s)=>(O(),q("div",{id:"strip-"+w.strip.id,ref_key:"el",ref:h,style:D(U(H)),class:X(["strip",U(l).selectedStrips.find(i=>i.id===t.strip.id)?"strip-selected":""]),onMousedown:J},[(O(),A(K(V(t.strip)),{strip:t.strip},null,8,["strip"])),E("div",{class:"handle",onMousedown:L},null,32),E("div",{class:"handle",style:{right:"0"},onMousedown:R},null,32),E("div",{style:D([{"background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",right:"-4px",top:"-4px",height:"49px"},{width:_.value+"px"}])},null,4)],46,st))}});var ut=z(rt,[["__scopeId","data-v-7d3a850c"]]);export{ut as default};
