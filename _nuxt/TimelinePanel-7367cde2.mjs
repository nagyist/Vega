import J from"./VIcons-735ae74e.mjs";import Q from"./StripUi-b3cd8c0f.mjs";import{p as Z,a as ee,e as te,b as le,A as ie,r as y,x as C,f as z,o as d,i as g,j as u,k as S,u as o,F as I,z as P,C as E,c as N,l as L,D as oe,E as se}from"./entry-09db89fd.mjs";import{u as ne}from"./useUpdate-86d98580.mjs";import{u as re}from"./useDragAndDrop-797abf19.mjs";import{u as ae}from"./usePixPerSec-a3affabe.mjs";import{s as c}from"./index-62af2367.mjs";import{k as ue}from"./mdi-4cca1244.mjs";import de from"./ScaleScroll-c483ed4d.mjs";import ce from"./SelectRect-98d349f4.mjs";import pe from"./TimeView-d96d0bb2.mjs";import ve from"./TimelineCursor-98e4272d.mjs";import"./useOperation-139b9087.mjs";import"./useKeyboard-549973a6.mjs";import"./onDragStart-b67a33ef.mjs";function fe(){const a=document.createElement("div");a.style.visibility="hidden",a.style.overflow="scroll",document.body.appendChild(a);const t=document.createElement("div");a.appendChild(t);const h=a.offsetWidth-t.offsetWidth;return a.remove(),h}const A=a=>(oe("data-v-52015f72"),a=a(),se(),a),me={style:{display:"flex",height:"20px"}},ye=A(()=>u("div",{style:{width:"100px","border-bottom":"1px solid white","border-right":"1px solid white"}},null,-1)),he={class:"timeline-box",tabindex:"0"},xe={style:{"border-right":"1px solid var(--border-grey)",height:"100%",width:"30px"}},ge={style:{width:"30px",height:"30px",display:"flex"}},_e={style:{"border-right":"1px solid var(--border-grey)",height:"100%",width:"70px"}},we=["strips"],be={class:"flex"},Se=A(()=>u("div",{style:{"border-right":"1px solid var(--border-grey)",width:"100px","min-width":"100px"}},null,-1)),Ee=ee({__name:"TimelinePanel",setup(a){const{timeline:t,addStrip:h,removeStrips:V,selectStrip:M,changeView:p,play:O,update:k,changeTimelineTool:D,init:_}=te(),{assets:R}=le(),{addUpdate:U}=ne(),{addEventListener:W}=ie(),{dad:T}=re(),x=y(null);C(()=>{if(!x.value)return;x.value.addEventListener("wheel",e=>{if(e.ctrlKey){const m=e.deltaY*.01,G=t.value.start-m,H=t.value.end+m;p(G,H)}else v.value+=e.deltaY,v.value<0?v.value=0:v.value>50*(w.value.length-1)&&(v.value=50*(w.value.length-1));const s=.01,i=t.value.start+e.deltaX*s;if(i<0){p(0,t.value.end);return}const n=t.value.end+e.deltaX*s;if(n>t.value.length){p(t.value.start,t.value.length);return}p(i,n)}),U(e=>{t.value.isPlay?k(t.value.curent+e/1e3):k(t.value.curent)}),window.addEventListener("keydown",e=>{var s;((s=document.activeElement)==null?void 0:s.tagName)!=="INPUT"&&e.key===" "&&O(!t.value.isPlay)}),W("resize",()=>{p(t.value.start+Number.EPSILON,t.value.end+Number.EPSILON)}),window.addEventListener("resize",()=>{p(t.value.start+Number.EPSILON,t.value.end+Number.EPSILON*5)})});const w=z(()=>{const l=[];for(const e of t.value.strips){if(l.length<=e.layer)for(let s=l.length;s<=e.layer;s++)l.push([]);l[e.layer].push(e)}return l.push([]),l}),$=z(()=>t.value.strips.map(l=>({strip:l,id:c.uuid()}))),b=y(!1),v=y(0);function j(){b.value=!0}function X(l){if(!f.value)return;b.value=!1;const e=f.value.getBoundingClientRect(),i=(t.value.end-t.value.start)/e.width;T.value.key==="assets"&&(r.value={effects:[],layer:0,start:(l.clientX-e.left)*i+t.value.start,length:1,id:"x"})}function F(){if(b.value&&M([]),b.value=!1,!!r.value){if(T.value.key==="assets"){const l=T.value.payload;if(!l){r.value=null;return}const e=R.value.assets.find(s=>s.id===l);if(console.warn("TODO add three.js object to scene"),(e==null?void 0:e.type)==="Video"){const i={effects:[{type:"Video",videoAssetId:l,animations:[],id:c.uuid(),position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},start:0,volume:1}],layer:0,start:r.value.start,length:r.value.length,id:c.uuid()};h(i),_()}else if((e==null?void 0:e.type)==="Image"){const i={effects:[{type:"Image",imageAssetId:l,animations:[],id:c.uuid(),position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},opacity:1}],layer:0,start:r.value.start,length:r.value.length,id:c.uuid()};h(i),_()}else if((e==null?void 0:e.type)==="Audio"){const i={effects:[{type:"Audio",audioAssetId:l,animations:[],id:c.uuid(),volume:1,start:0}],layer:0,start:r.value.start,length:r.value.length,id:c.uuid()};h(i),_()}else if((e==null?void 0:e.type)==="Text"){const i={effects:[{type:"Text",characterSpace:0,text:"Text",color:"#fff",family:"Arial",outlineColor:"#000",outlineWidth:1,size:24,animations:[],id:c.uuid(),position:{x:0,y:0,z:0},shadowBlur:0,shadowColor:"#000",style:"normal"}],layer:0,start:r.value.start,length:r.value.length,id:c.uuid()};h(i),_()}}r.value=null}}const Y=y(null),B=y(null),f=y(null);C(()=>{var l,e,s;(l=f.value)==null||l.addEventListener("scroll",()=>{var i;!B.value||(B.value.scrollTop=((i=f.value)==null?void 0:i.scrollTop)||0)}),(e=x.value)==null||e.addEventListener("mouseenter",()=>{var i;(i=x.value)==null||i.focus()}),(s=x.value)==null||s.addEventListener("keydown",i=>{i.key==="x"&&t.value.selectedStrips.length>0&&V(t.value.selectedStrips.map(n=>n.id))})}),y(fe());const r=y();function K(l){D(l)}const q=z(()=>ae(f.value));return(l,e)=>{const s=J,i=Q;return d(),g("div",{ref_key:"el",ref:x,class:"timeline-root",tabindex:"0"},[u("div",{ref_key:"timelineBody",ref:Y,style:{width:"calc(100%)",position:"relative",overflow:"hidden"}},[u("div",me,[ye,S(pe,{start:o(t).start,length:o(t).end-o(t).start,style:{width:"calc(100% - 100px)"},onMove:e[0]||(e[0]=n=>o(k)(n,!0))},null,8,["start","length"])]),u("div",he,[u("div",xe,[u("div",ge,[S(s,{style:{margin:"auto"},path:o(ue),fill:o(t).timelineTool=="cursor"?"white":"gray",onClick:e[1]||(e[1]=()=>K("cursor"))},null,8,["path","fill"])])]),u("div",_e,[(d(!0),g(I,null,P(o(w),(n,m)=>(d(),g("div",{key:m,style:E(`
            border-bottom: 1px solid var(--border-grey);
            height: 50px;
            box-sizing: content-box;
            position: absolute;
            width: 100px;
            top: ${m*50-v.value}px;
          `)},null,4))),128))]),u("div",{ref_key:"timelineBox",ref:f,style:E(`width: calc(100% - ${100}px); overflow-x: clip; display: flex; position: relative; height: 100%`),onMouseup:F,onMousedown:j,onMousemove:X},[S(ve,{style:E({left:(o(t).curent-o(t).start)*o(q)+"px"})},null,8,["style"]),f.value?(d(),N(ce,{key:0,element:f.value},null,8,["element"])):L("",!0),(d(!0),g(I,null,P(o(w),(n,m)=>(d(),g("div",{key:m,strips:n,class:"layer",style:E(`top: ${m*50-v.value}px`)},null,12,we))),128)),(d(!0),g(I,null,P(o($),n=>(d(),N(i,{key:n.id,strip:n.strip,top:v.value},null,8,["strip","top"]))),128)),r.value?(d(),N(i,{key:"dummy",strip:r.value},null,8,["strip"])):L("",!0)],36)]),u("div",be,[Se,S(de,{style:{position:"relative",bottom:"0"},start:o(t).start/o(t).length,end:o(t).end/o(t).length,onStart:e[2]||(e[2]=n=>o(p)(n*o(t).length,o(t).end)),onEnd:e[3]||(e[3]=n=>o(p)(o(t).start,n*o(t).length))},null,8,["start","end"])])],512)],512)}}});var Ue=Z(Ee,[["__scopeId","data-v-52015f72"]]);export{Ue as default};
