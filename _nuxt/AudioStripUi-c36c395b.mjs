import{p as H,a as L,e as $,b as q,r as d,f as v,x as J,w as B,u as K,o as Q,i as W,j as O,z as X,l as Y,D as Z,E as ee,G as I}from"./entry-19bb174e.mjs";const te=L({__name:"AudioStripUi",props:{strip:null},setup(P){const h=P,{timeline:s}=$(),{assets:U}=q(),V=d([]),c=v(()=>h.strip.effects.find(e=>e.type==="Audio")),z=v(()=>{var e;return((e=U.value.assets.find(t=>t.id===c.value.audioAssetId))==null?void 0:e.path)||""}),u=d(null),R=v(()=>{var n,i,o;const e=((o=(i=(n=u.value)==null?void 0:n.parentElement)==null?void 0:i.parentElement)==null?void 0:o.getBoundingClientRect().width)||1,t=(s.value.end-s.value.start)/s.value.length;return e/s.value.length/t}),F=v(()=>Z.get(c.value.id)),N=40,r=d(null),a=d(null);let f=null;const C=v(()=>(h.strip.start-s.value.start)*R.value);function S(){var A,M,j,k,D;if(!a.value)return;const e=(M=(A=r.value)==null?void 0:A.parentElement)==null?void 0:M.getBoundingClientRect(),t=(k=(j=u.value)==null?void 0:j.parentElement)==null?void 0:k.getBoundingClientRect();if(!e||!t||!f)return;const n=f.sampleRate,i=f.getChannelData(0),o=t.width/R.value,b=Math.floor(o*n),g=Math.floor(b/t.width),m=[];let _=0,w=0,x=Math.floor(c.value.start*n);C.value<-50&&(x=Math.floor(g*(-50-C.value)));for(let l=x;l<b+x;l++)if(_+=Math.abs(i[l]),w++,w>=g){const y=_/g;m.push(y),_=0,w=0}if(a.value.clearRect(0,0,e.width,e.height),a.value.fillStyle="#fff2",a.value.fillRect(0,0,e.width,e.height),a.value.fillStyle="orange",!!((D=r.value)==null?void 0:D.getBoundingClientRect()))for(let l=0;l<m.length;l++){const y=m[l+12]*40;a.value.fillRect(l,40-y*2*c.value.volume,1,40)}}let E=!1;function T(){if(f){S();return}E||(E=!0,fetch(z.value).then(e=>e.arrayBuffer()).then(async e=>{var n,i;await ee(),!(!I||!a.value||!((i=(n=u.value)==null?void 0:n.parentElement)==null?void 0:i.getBoundingClientRect()))&&I.decodeAudioData(e).then(o=>{f=o,S()})}))}J(()=>{!F.value||!r.value||(a.value=r.value.getContext("2d"),p())});const G=d(0),p=()=>{if(!u.value)return;const e=u.value.getBoundingClientRect();!e||!r.value||(r.value.width=e.width,T())};return B(V.value,()=>p()),B(h.strip,()=>{p()}),B(s.value,()=>{p()}),(e,t)=>K(c)?(Q(),W("div",{key:0,ref_key:"el",ref:u,style:{height:"100%",display:"flex",overflow:"hidden",padding:"0 4px",position:"absolute",width:"100%"}},[O("div",{style:X(`margin-left: ${G.value+4}px; display: flex; pointer-events: none;`)},[O("canvas",{ref_key:"canvas",ref:r,height:N,class:"video"},null,512)],4)],512)):Y("",!0)}});var le=H(te,[["__scopeId","data-v-3ef73c6d"]]);export{le as default};
