import{a as J,u as K}from"./useTimeline-6cb6bf32.mjs";import{k as L,a as $,r as d,b as v,E as q,w as R,u as G,o as Q,f as W,h as D,H as X,j as Y,R as Z,J as ee,K as I}from"./entry-cf7f9e40.mjs";const te=$({__name:"AudioStripUi",props:{strip:null},setup(P){const h=P,{timeline:u}=J(),{assets:U}=K(),V=d([]),c=v(()=>h.strip.effects.find(e=>e.type==="Audio")),F=v(()=>{var e;return((e=U.value.assets.find(t=>t.id===c.value.audioAssetId))==null?void 0:e.path)||""}),s=d(null),B=v(()=>{var n,i,o;const e=((o=(i=(n=s.value)==null?void 0:n.parentElement)==null?void 0:i.parentElement)==null?void 0:o.getBoundingClientRect().width)||1,t=(u.value.end-u.value.start)/u.value.length;return e/u.value.length/t}),H=v(()=>Z.effectObjectMap.get(c.value.id)),N=40,r=d(null),a=d(null);let f=null;const C=v(()=>(h.strip.start-u.value.start)*B.value);function S(){var A,M,k,j,O;if(!a.value)return;const e=(M=(A=r.value)==null?void 0:A.parentElement)==null?void 0:M.getBoundingClientRect(),t=(j=(k=s.value)==null?void 0:k.parentElement)==null?void 0:j.getBoundingClientRect();if(!e||!t||!f)return;const n=f.sampleRate,i=f.getChannelData(0),o=t.width/B.value,b=Math.floor(o*n),g=Math.floor(b/t.width),m=[];let _=0,w=0,y=Math.floor(c.value.start*n);C.value<-50&&(y=Math.floor(g*(-50-C.value)));for(let l=y;l<b+y;l++)if(_+=Math.abs(i[l]),w++,w>=g){const x=_/g;m.push(x),_=0,w=0}if(a.value.clearRect(0,0,e.width,e.height),a.value.fillStyle="#fff2",a.value.fillRect(0,0,e.width,e.height),a.value.fillStyle="orange",!!((O=r.value)==null?void 0:O.getBoundingClientRect()))for(let l=0;l<m.length;l++){const x=m[l+12]*40;a.value.fillRect(l,40-x*2*c.value.volume,1,40)}}let E=!1;function T(){if(f){S();return}E||(E=!0,fetch(F.value).then(e=>e.arrayBuffer()).then(async e=>{var n,i;await ee(),!(!I||!a.value||!((i=(n=s.value)==null?void 0:n.parentElement)==null?void 0:i.getBoundingClientRect()))&&I.decodeAudioData(e).then(o=>{f=o,S()})}))}q(()=>{!H.value||!r.value||(a.value=r.value.getContext("2d"),p())});const z=d(0),p=()=>{if(!s.value)return;const e=s.value.getBoundingClientRect();!e||!r.value||(r.value.width=e.width,T())};return R(V.value,()=>p()),R(h.strip,()=>{p()}),R(u.value,()=>{p()}),(e,t)=>G(c)?(Q(),W("div",{key:0,ref_key:"el",ref:s,style:{height:"100%",display:"flex",overflow:"hidden",padding:"0 4px",position:"absolute",width:"100%"}},[D("div",{style:X(`margin-left: ${z.value+4}px; display: flex; pointer-events: none;`)},[D("canvas",{ref_key:"canvas",ref:r,height:N,class:"video"},null,512)],4)],512)):Y("",!0)}});var re=L(te,[["__scopeId","data-v-0c5d18f2"]]);export{re as default};
