import{a as L,s as W}from"./useTimeline-7a16e4c3.mjs";import{u as X}from"./useOperation-edb40d6f.mjs";import{u as q}from"./useKeyboard-a488986f.mjs";import{u as A}from"./usePixPerSec-a1f9d7e8.mjs";import{k as K,a as Y,r as k,b,u as E,o as D,f as G,c as Q,E as Z,h as w,I as U,X as tt,j as et,a6 as st}from"./entry-5a88fbbc.mjs";import{c as rt}from"./clone-0e5b969a.mjs";import{o as C}from"./onDragStart-b67a33ef.mjs";const it=["id"],nt=Y({__name:"StripUi",props:{strip:{type:Object,required:!0},top:{default:0,type:Number}},setup(I){const t=I,{timeline:o,moveStrip:l,selectStrip:M}=L(),{pushHistory:m}=X(),{keyboard:N}=q(),P=50,h=k(null),a=b(()=>{var e;return A((e=h.value)==null?void 0:e.parentElement)}),g=50,y=28,_=k(0),V=b(()=>{let e=(t.strip.start-o.value.start)*a.value;const r=t.strip.start+t.strip.length;let i=t.strip.length;r>o.value.end&&(i=o.value.end-t.strip.start+50/a.value);let s=i*a.value;return e<-g&&(s+=e+g,e=-g),s<=y?(_.value=y-s,s=y):_.value=0,{width:s+"px",position:"absolute",top:t.strip.layer*P+1-t.top+"px",left:e+"px"}}),S=k(!1);function H(e){var c;e.preventDefault(),e.stopPropagation();const r=(c=h.value)==null?void 0:c.parentElement,i=r==null?void 0:r.getBoundingClientRect();if(!i)return;const s={start:t.strip.start,length:t.strip.length,id:t.strip.id,layer:t.strip.layer},d=s.start;let n={...s},p=o.value.selectedStrips.filter(f=>f.id!==t.strip.id);const u=p.map(f=>rt(f));S.value=!0,C(e,(f,z,T)=>{o.value.selectedStrips.find(v=>v.id===t.strip.id)||(N.value.shift||(p=[]),B(t.strip)),S.value=!1;const x=Math.floor((z.clientY-i.top+t.top)/P);x<0||(n={id:s.id,layer:x,start:d+T.x/a.value,length:s.length},l(n.id,n.start,n.length,n.layer),p.forEach((v,O)=>{const F=-s.layer+u[O].layer;l(v.id,u[O].start+T.x/a.value,v.length,x+F)}))},()=>{if(S.value){B(t.strip);return}m(`MoveStrip: ${JSON.stringify(n,null,2)}`),st.push(()=>{m(`Undo MoveStrip: ${JSON.stringify(s,null,2)}`),l(s.id,s.start,s.length,s.layer)},()=>{m(`Redo MoveStrip: ${JSON.stringify(n,null,2)}`),l(n.id,n.start,n.length,n.layer)})})}function J(e){e.stopPropagation();const r=t.strip.start+t.strip.length,i=t.strip.start,s=t.strip.length;C(e,(d,n,p)=>{const u=W(p.x/a.value),c=i+u;c>r||l(t.strip.id,c,s-u,t.strip.layer)})}function R(e){e.stopPropagation();const r=t.strip.length;C(e,(i,s,d)=>{const n=r+d.x/a.value;n<0||l(t.strip.id,t.strip.start,n)})}function $(e){for(let r=0;r<e.effects.length;r++){const i=e.effects[r];if(i.type==="Text")return"text-strip-ui";if(i.type==="Video")return"video-strip-ui";if(i.type==="Audio")return"audio-strip-ui";if(i.type==="Image")return"image-strip-ui";console.warn("unknown effect type",i.type)}}function B(e){N.value.shift?M(o.value.selectedStrips.map(r=>r.id).concat([e.id])):M([e.id])}const j=b(()=>t.strip.start<o.value.end);return(e,r)=>E(j)?(D(),G("div",{key:0,id:"strip-"+I.strip.id,ref_key:"el",ref:h,style:U(E(V)),class:tt(["strip",E(o).selectedStrips.find(i=>i.id===t.strip.id)?"strip-selected":""]),onMousedown:H},[(D(),Q(Z($(t.strip)),{strip:t.strip},null,8,["strip"])),w("div",{class:"handle",onMousedown:J},null,32),w("div",{class:"handle",style:{right:"0"},onMousedown:R},null,32),w("div",{style:U([{"background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",right:"-4px",top:"-4px",height:"49px"},{width:_.value+"px"}])},null,4)],46,it)):et("",!0)}});var ft=K(nt,[["__scopeId","data-v-52da8b10"]]);export{ft as default};
