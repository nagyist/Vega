import{a as V,e as m,T as B,c,f as k,V as G,b as j,I as N,s as z}from"./useTimeline-6cb6bf32.mjs";import{s as E}from"./index-649d6e05.mjs";import{o as R}from"./onDragStart-b67a33ef.mjs";import{s as H}from"./setAnimation-30ab6762.mjs";import{k as q,a as D,b as d,r as x,E as U,w as J,o as T,f as I,u as y,H as O,j as K,R as g}from"./entry-cf7f9e40.mjs";const L=["value"],Q=D({__name:"PreviewGizmo",props:{scale:null},setup(W){const n=W,{timeline:s,updateEffect:_,setFocusStripId:h}=V(),l=d(()=>s.value.selectedStrips[0]),e=d(()=>{var a;return((a=l.value)==null?void 0:a.effects.length)>0?l.value.effects[0]:null}),r=x({}),v=x(!1),$=d(()=>e.value&&m(e.value)),C=d(()=>{if(e.value&&m(e.value))return e.value.text}),F=d(()=>{var a,i;return e.value&&m(e.value)?{fontSize:`${e.value.size*n.scale}px`,fontFamily:e.value.family,width:`calc(${r.value.width} + 10px)`,color:e.value.color,height:`${r.value.height}`,lineHeight:`${(Number.parseFloat(((i=(a=r.value)==null?void 0:a.height)==null?void 0:i.toString())||"0")||0)/e.value.text.split(`
`).length}px`,letterSpacing:`${e.value.characterSpace*n.scale}px`,visibility:v.value?"visible":"hidden"}:{}});function M(a){const i=a.target;_(l.value.id,{...e.value,text:i.value||""})}function b(){if(!e.value)return{display:"none"};const a=s.value.width,i=s.value.height;if(m(e.value)){const t=g.effectObjectMap.get(e.value.id);if(!(t instanceof B))return{display:"none"};const o=c(e.value.animations,s.value.curent-l.value.start,"position.x",e.value.position.x),u=c(e.value.animations,s.value.curent-l.value.start,"position.y",e.value.position.y);return{left:(a/2+o-t.mesureWidth/2)*n.scale+"px",bottom:(i/2+u-t.mesureHeight/2)*n.scale+"px",width:t.mesureWidth*n.scale+"px",height:t.mesureHeight*n.scale+"px"}}else if(k(e.value)){const t=g.effectObjectMap.get(e.value.id);if(!(t instanceof G))return{display:"none"};const o=c(e.value.animations,s.value.curent,"position.x",e.value.position.x),u=c(e.value.animations,s.value.curent,"position.y",e.value.position.y),p=t.video.videoWidth*e.value.scale.x,f=t.video.videoHeight*e.value.scale.y;return{left:(a/2+o-p/2)*n.scale-1+"px",bottom:(i/2+u-f/2)*n.scale+2+"px",width:p*n.scale+"px",height:f*n.scale+"px"}}else if(j(e.value)){const t=g.effectObjectMap.get(e.value.id);if(!(t instanceof N))return{display:"none"};const o=c(e.value.animations,s.value.curent,"position.x",e.value.position.x),u=c(e.value.animations,s.value.curent,"position.y",e.value.position.y),p=t.width*e.value.scale.x,f=t.height*e.value.scale.y;return{left:(a/2+o-p/2)*n.scale+"px",bottom:(i/2+u-f/2)*n.scale+"px",width:p*n.scale+"px",height:f*n.scale+"px"}}return{display:"none"}}U(()=>{const a=()=>{r.value=b(),window.requestAnimationFrame(a)};a()});const w=x(0),S=x(null);J(e,(a,i)=>{a&&i&&a.id!==i.id&&(v.value=!1,h(""))});function A(a){a.timeStamp-w.value<500&&(v.value=!0),w.value=a.timeStamp,v.value?(h(l.value.id),b(),setTimeout(()=>{var i;(i=S.value)==null||i.focus()})):h("")}function P(a){!e.value||v.value||R(a,i=>{if(!!e.value&&(m(e.value)||k(e.value)||j(e.value))){const t={...e.value,animations:[...e.value.animations]},o={x:t.position.x+i.x/n.scale,y:t.position.y-i.y/n.scale,z:t.position.z};e.value.animations.filter(u=>u.key==="position.x").length===0?t.position=o:(o.x=c(t.animations,s.value.curent-l.value.start,"position.x")+i.x/n.scale,t.animations=H(t.animations,{id:E.uuid(),key:"position.x",value:o.x,time:z(s.value.curent-l.value.start)})),e.value.animations.filter(u=>u.key==="position.y").length===0?t.position=o:(o.y=c(t.animations,s.value.curent-l.value.start,"position.y")+-i.y/n.scale,t.animations=H(t.animations,{id:E.uuid(),key:"position.y",value:o.y,time:z(s.value.curent-l.value.start)})),t.position=o,_(l.value.id,{...t})}})}return(a,i)=>(T(),I("div",{class:"gizmo",style:O(r.value),onClick:A,onPointerdown:P},[y($)?(T(),I("textarea",{key:0,ref_key:"textarea",ref:S,value:y(C),class:"text-gizmo",style:O(y(F)),onInput:M},null,44,L)):K("",!0)],36))}});var ae=q(Q,[["__scopeId","data-v-4e061672"]]);export{ae as default};
