import{a as W,s as X}from"./useTimeline-7b6b3688.mjs";import{u as q}from"./useOperation-e4c938df.mjs";import{u as A}from"./useKeyboard-e09c2754.mjs";import{u as K}from"./usePixPerSec-474d68cf.mjs";import{k as Y,a as G,r as k,b,u as E,o as U,f as Q,c as Z,E as tt,h as w,I as D,X as et,j as st,a7 as rt}from"./entry-a6629a66.mjs";import{c as it}from"./clone-0e5b969a.mjs";import{o as C}from"./onDragStart-b67a33ef.mjs";const nt=["id"],ot=G({__name:"StripUi",props:{strip:{type:Object,required:!0},top:{default:0,type:Number}},setup(I){const t=I,V=rt.main,{timeline:o,moveStrip:l,selectStrip:M}=W(),{pushHistory:v}=q(),{keyboard:N}=A(),P=50,h=k(null),a=b(()=>{var e;return K((e=h.value)==null?void 0:e.parentElement)}),g=50,y=28,_=k(0),H=b(()=>{let e=(t.strip.start-o.value.start)*a.value;const r=t.strip.start+t.strip.length;let i=t.strip.length;r>o.value.end&&(i=o.value.end-t.strip.start+50/a.value);let s=i*a.value;return e<-g&&(s+=e+g,e=-g),s<=y?(_.value=y-s,s=y):_.value=0,{width:s+"px",position:"absolute",top:t.strip.layer*P+1-t.top+"px",left:e+"px"}}),S=k(!1);function J(e){var c;e.preventDefault(),e.stopPropagation();const r=(c=h.value)==null?void 0:c.parentElement,i=r==null?void 0:r.getBoundingClientRect();if(!i)return;const s={start:t.strip.start,length:t.strip.length,id:t.strip.id,layer:t.strip.layer},d=s.start;let n={...s},p=o.value.selectedStrips.filter(f=>f.id!==t.strip.id);const u=p.map(f=>it(f));S.value=!0,C(e,(f,F,T)=>{o.value.selectedStrips.find(m=>m.id===t.strip.id)||(N.value.shift||(p=[]),B(t.strip)),S.value=!1;const x=Math.floor((F.clientY-i.top+t.top)/P);x<0||(n={id:s.id,layer:x,start:d+T.x/a.value,length:s.length},l(n.id,n.start,n.length,n.layer),p.forEach((m,O)=>{const L=-s.layer+u[O].layer;l(m.id,u[O].start+T.x/a.value,m.length,x+L)}))},()=>{if(S.value){B(t.strip);return}v(`MoveStrip: ${JSON.stringify(n,null,2)}`),V.push(()=>{v(`Undo MoveStrip: ${JSON.stringify(s,null,2)}`),l(s.id,s.start,s.length,s.layer)},()=>{v(`Redo MoveStrip: ${JSON.stringify(n,null,2)}`),l(n.id,n.start,n.length,n.layer)})})}function R(e){e.stopPropagation();const r=t.strip.start+t.strip.length,i=t.strip.start,s=t.strip.length;C(e,(d,n,p)=>{const u=X(p.x/a.value),c=i+u;c>r||l(t.strip.id,c,s-u,t.strip.layer)})}function $(e){e.stopPropagation();const r=t.strip.length;C(e,(i,s,d)=>{const n=r+d.x/a.value;n<0||l(t.strip.id,t.strip.start,n)})}function j(e){for(let r=0;r<e.effects.length;r++){const i=e.effects[r];if(i.type==="Text")return"text-strip-ui";if(i.type==="Video")return"video-strip-ui";if(i.type==="Audio")return"audio-strip-ui";if(i.type==="Image")return"image-strip-ui";console.warn("unknown effect type",i.type)}}function B(e){N.value.shift?M(o.value.selectedStrips.map(r=>r.id).concat([e.id])):M([e.id])}const z=b(()=>t.strip.start<o.value.end);return(e,r)=>E(z)?(U(),Q("div",{key:0,id:"strip-"+I.strip.id,ref_key:"el",ref:h,style:D(E(H)),class:et(["strip",E(o).selectedStrips.find(i=>i.id===t.strip.id)?"strip-selected":""]),onMousedown:J},[(U(),Z(tt(j(t.strip)),{strip:t.strip},null,8,["strip"])),w("div",{class:"handle",onMousedown:R},null,32),w("div",{class:"handle",style:{right:"0"},onMousedown:$},null,32),w("div",{style:D([{"background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",right:"-4px",top:"-4px",height:"49px"},{width:_.value+"px"}])},null,4)],46,nt)):st("",!0)}});var mt=Y(ot,[["__scopeId","data-v-7b427689"]]);export{mt as default};
