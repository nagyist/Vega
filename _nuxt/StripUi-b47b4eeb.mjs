import{a as F,s as L}from"./useTimeline-6cb6bf32.mjs";import{u as j}from"./useOperation-c4039ac0.mjs";import{u as q}from"./useKeyboard-b743da98.mjs";import{u as A}from"./usePixPerSec-9f443e7e.mjs";import{k as K,a as X,r as k,b as T,o as O,f as Y,c as G,B as Q,h as b,H as D,u as H,W as Z,a5 as tt}from"./entry-cf7f9e40.mjs";import{c as et}from"./clone-0e5b969a.mjs";import{o as E}from"./onDragStart-b67a33ef.mjs";const st=["id"],rt=X({__name:"StripUi",props:{strip:{type:Object,required:!0},top:{default:0,type:Number}},setup(w){const t=w,{timeline:l,moveStrip:o,selectStrip:M}=F(),{pushHistory:v}=j(),{keyboard:P}=q(),B=50,h=k(null),a=T(()=>{var e;return A((e=h.value)==null?void 0:e.parentElement)}),y=50,g=28,_=k(0),U=T(()=>{let e=(t.strip.start-l.value.start)*a.value,s=t.strip.length*a.value;return e<-y&&(s+=e+y,e=-y),s<=g?(_.value=g-s,s=g):_.value=0,{width:s+"px",position:"absolute",top:t.strip.layer*B+1-t.top+"px",left:e+"px"}}),S=k(!1);function J(e){var c;e.preventDefault(),e.stopPropagation();const s=(c=h.value)==null?void 0:c.parentElement,i=s==null?void 0:s.getBoundingClientRect();if(!i)return;const n={start:t.strip.start,length:t.strip.length,id:t.strip.id,layer:t.strip.layer},d=n.start;let r={...n},p=l.value.selectedStrips.filter(f=>f.id!==t.strip.id);const u=p.map(f=>et(f));S.value=!0,E(e,(f,$,I)=>{l.value.selectedStrips.find(m=>m.id===t.strip.id)||(P.value.shift||(p=[]),C(t.strip)),S.value=!1;const x=Math.floor(($.clientY-i.top+t.top)/B);x<0||(r={id:n.id,layer:x,start:d+I.x/a.value,length:n.length},o(r.id,r.start,r.length,r.layer),p.forEach((m,N)=>{const z=-n.layer+u[N].layer;o(m.id,u[N].start+I.x/a.value,m.length,x+z)}))},()=>{if(S.value){C(t.strip);return}v(`MoveStrip: ${JSON.stringify(r,null,2)}`),tt.push(()=>{v(`Undo MoveStrip: ${JSON.stringify(n,null,2)}`),o(n.id,n.start,n.length,n.layer)},()=>{v(`Redo MoveStrip: ${JSON.stringify(r,null,2)}`),o(r.id,r.start,r.length,r.layer)})})}function R(e){e.stopPropagation();const s=t.strip.start+t.strip.length,i=t.strip.start,n=t.strip.length;E(e,(d,r,p)=>{const u=L(p.x/a.value),c=i+u;c>s||o(t.strip.id,c,n-u,t.strip.layer)})}function V(e){e.stopPropagation();const s=t.strip.length;E(e,(i,n,d)=>{const r=s+d.x/a.value;r<0||o(t.strip.id,t.strip.start,r)})}function W(e){for(let s=0;s<e.effects.length;s++){const i=e.effects[s];if(i.type==="Text")return"text-strip-ui";if(i.type==="Video")return"video-strip-ui";if(i.type==="Audio")return"audio-strip-ui";if(i.type==="Image")return"image-strip-ui";console.warn("unknown effect type",i.type)}}function C(e){P.value.shift?M(l.value.selectedStrips.map(s=>s.id).concat([e.id])):M([e.id])}return(e,s)=>(O(),Y("div",{id:"strip-"+w.strip.id,ref_key:"el",ref:h,style:D(H(U)),class:Z(["strip",H(l).selectedStrips.find(i=>i.id===t.strip.id)?"strip-selected":""]),onMousedown:J},[(O(),G(Q(W(t.strip)),{strip:t.strip},null,8,["strip"])),b("div",{class:"handle",onMousedown:R},null,32),b("div",{class:"handle",style:{right:"0"},onMousedown:V},null,32),b("div",{style:D([{"background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",right:"-4px",top:"-4px",height:"49px"},{width:_.value+"px"}])},null,4)],46,st))}});var ct=K(rt,[["__scopeId","data-v-9562c0f0"]]);export{ct as default};
