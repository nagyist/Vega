import w from"./PreviewGizmo-5abdc92f.mjs";import y from"./VInput-922c0fbe.mjs";import{u as x}from"./useUpdate-f679181c.mjs";import{a as S,r as u,e as k,x as $,Z as b,$ as i,f as P,o as R,i as z,j as o,k as h,t as B,u as F}from"./entry-7dd23744.mjs";import{R as j}from"./Recorder-01d1abf1.mjs";import"./index-1c238c95.mjs";import"./onDragStart-b67a33ef.mjs";import"./setAnimation-30ab6762.mjs";import"./VIcons-e88692b6.mjs";import"./mdi-00233b2d.mjs";function D(v){let e=v;e<0&&(e=-e);const m=e.toFixed(3).split(".")[1],t=new Date(e*1e3).toISOString().substr(11,8);let r="";return e<0&&(r="-"),`${r}${t}.${m}`}const I={style:{display:"flex",height:"calc(100% - 24px)",overflow:"hidden"}},M={style:{margin:"auto",position:"relative"}},N={style:{"line-height":"12px",height:"24px","text-align":"center",display:"flex","border-top":"1px solid white"}},U={style:{display:"flex","white-space":"nowrap",margin:"auto"}},V={style:{margin:"auto"}},H=S({__name:"PreviewPanel",setup(v){const e=u(null),d=u(null),{addUpdate:m}=x(),{timeline:t,selectStrip:r}=k(),l=u(.2),f=u(null);$(()=>{if(!e.value||!d.value)return;f.value=new j(e.value);const a=new b({canvas:e.value}),n=t.value.width,s=t.value.height;a.setSize(n,s),i.camera.left===0&&(i.camera.left=-n/2,i.camera.right=n/2,i.camera.top=s/2,i.camera.bottom=-s/2,i.camera.near=-100,i.camera.far=1e3),m(()=>{var c;!e.value||(a.setSize(n,s),e.value.style.margin="auto",e.value.style.width=`${n*l.value}px`,e.value.style.height="",i.camera.updateProjectionMatrix(),a.render(i.scene,i.camera),t.value.isRecording&&t.value.curent>t.value.length&&((c=f.value)==null||c.stop()))})});const _=P(()=>D(t.value.curent));function g(){for(const a of t.value.strips)if(a.start<t.value.curent&&a.start+a.length>t.value.curent){if(t.value.selectedStrips.find(s=>s.id===a.id))continue;r([a.id]);break}}return(a,n)=>{const s=w,c=y;return R(),z("div",{ref_key:"el",ref:d,style:{height:"100%",width:"100%",overflow:"hidden"}},[o("div",I,[o("div",M,[h(s,{scale:l.value},null,8,["scale"]),o("canvas",{ref_key:"canvas",ref:e,style:{width:"100%",height:"100%",margin:"auto"},onPointerdown:g},null,544)])]),o("div",N,[o("div",U,[h(c,{style:{height:"16px"},value:l.value,scale:.01,step:.01,min:.1,max:1,view:p=>p.toFixed(2),onInput:n[0]||(n[0]=p=>l.value=p)},null,8,["value","scale","step","min","view"])]),o("div",V,B(F(_)),1)])],512)}}});export{H as default};
