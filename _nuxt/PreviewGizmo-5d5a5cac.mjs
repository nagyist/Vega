import{p as B,a as D,e as G,f as m,r as x,x as M,w as N,o as k,i as z,u as y,z as j,l as U,U as d,D as g,V as q,J as c,W as E,X as J,I as H,Y as R,R as I}from"./entry-5722d099.mjs";import{s as T}from"./index-bd2fa27e.mjs";import{o as X}from"./onDragStart-b67a33ef.mjs";import{s as W}from"./setAnimation-30ab6762.mjs";const Y=["value"],K=D({__name:"PreviewGizmo",props:{scale:null},setup($){const n=$,{timeline:s,updateEffect:_,setFocusStripId:h}=G(),l=m(()=>s.value.selectedStrips[0]),e=m(()=>{var a;return((a=l.value)==null?void 0:a.effects.length)>0?l.value.effects[0]:null}),r=x({}),v=x(!1),C=m(()=>e.value&&d(e.value)),F=m(()=>{if(e.value&&d(e.value))return e.value.text}),O=m(()=>{var a,i;return e.value&&d(e.value)?{fontSize:`${e.value.size*n.scale}px`,fontFamily:e.value.family,width:`calc(${r.value.width} + 10px)`,color:e.value.color,height:`${r.value.height}`,lineHeight:`${(Number.parseFloat(((i=(a=r.value)==null?void 0:a.height)==null?void 0:i.toString())||"0")||0)/e.value.text.split(`
`).length}px`,letterSpacing:`${e.value.characterSpace*n.scale}px`,visibility:v.value?"visible":"hidden"}:{}});function A(a){const i=a.target;_(l.value.id,{...e.value,text:i.value||""})}function w(){if(!e.value)return{display:"none"};const a=s.value.width,i=s.value.height;if(d(e.value)){const t=g.get(e.value.id);if(!(t instanceof q))return{display:"none"};const o=c(e.value.animations,s.value.curent-l.value.start,"position.x",e.value.position.x),u=c(e.value.animations,s.value.curent-l.value.start,"position.y",e.value.position.y);return{left:(a/2+o-t.mesureWidth/2)*n.scale+"px",bottom:(i/2+u-t.mesureHeight/2)*n.scale+"px",width:t.mesureWidth*n.scale+"px",height:t.mesureHeight*n.scale+"px"}}else if(E(e.value)){const t=g.get(e.value.id);if(!(t instanceof J))return{display:"none"};const o=c(e.value.animations,s.value.curent,"position.x",e.value.position.x),u=c(e.value.animations,s.value.curent,"position.y",e.value.position.y),p=t.video.videoWidth*e.value.scale.x,f=t.video.videoHeight*e.value.scale.y;return{left:(a/2+o-p/2)*n.scale-1+"px",bottom:(i/2+u-f/2)*n.scale+2+"px",width:p*n.scale+"px",height:f*n.scale+"px"}}else if(H(e.value)){const t=g.get(e.value.id);if(!(t instanceof R))return{display:"none"};const o=c(e.value.animations,s.value.curent,"position.x",e.value.position.x),u=c(e.value.animations,s.value.curent,"position.y",e.value.position.y),p=t.width*e.value.scale.x,f=t.height*e.value.scale.y;return{left:(a/2+o-p/2)*n.scale+"px",bottom:(i/2+u-f/2)*n.scale+"px",width:p*n.scale+"px",height:f*n.scale+"px"}}return{display:"none"}}M(()=>{const a=()=>{r.value=w(),window.requestAnimationFrame(a)};a()});const S=x(0),b=x(null);N(e,(a,i)=>{a&&i&&a.id!==i.id&&(v.value=!1,h(""))});function P(a){a.timeStamp-S.value<500&&(v.value=!0),S.value=a.timeStamp,v.value?(h(l.value.id),w(),setTimeout(()=>{var i;(i=b.value)==null||i.focus()})):h("")}function V(a){!e.value||v.value||X(a,i=>{if(!!e.value&&(d(e.value)||E(e.value)||H(e.value))){const t={...e.value,animations:[...e.value.animations]},o={x:t.position.x+i.x/n.scale,y:t.position.y-i.y/n.scale,z:t.position.z};e.value.animations.filter(u=>u.key==="position.x").length===0?t.position=o:(o.x=c(t.animations,s.value.curent-l.value.start,"position.x")+i.x/n.scale,t.animations=W(t.animations,{id:T.uuid(),key:"position.x",value:o.x,time:I(s.value.curent-l.value.start)})),e.value.animations.filter(u=>u.key==="position.y").length===0?t.position=o:(o.y=c(t.animations,s.value.curent-l.value.start,"position.y")+-i.y/n.scale,t.animations=W(t.animations,{id:T.uuid(),key:"position.y",value:o.y,time:I(s.value.curent-l.value.start)})),t.position=o,_(l.value.id,{...t})}})}return(a,i)=>(k(),z("div",{class:"gizmo",style:j(r.value),onClick:P,onPointerdown:V},[y(C)?(k(),z("textarea",{key:0,ref_key:"textarea",ref:b,value:y(F),class:"text-gizmo",style:j(y(O)),onInput:A},null,44,Y)):U("",!0)],36))}});var te=B(K,[["__scopeId","data-v-2a60cd91"]]);export{te as default};
