import D from"./VInputBase-01c2539a.mjs";import U from"./TimeView-02e7e8ed.mjs";import q from"./TimelineCursor-32e24d5c.mjs";import G from"./ScaleScroll-f18efe97.mjs";import{a as H,e as J,A as Q,f as C,r as c,$ as W,w as B,x as X,u as i,o as r,i as v,j as p,F as x,z as w,k as y,C as P,l as Y,t as Z,I as ee,c as te}from"./entry-46ab768b.mjs";import ae from"./KeyframeMarker-4e83826f.mjs";import le from"./KeyframeSelectRect-020fee07.mjs";import"./usePixPerSec-361cd983.mjs";import"./onDragStart-b67a33ef.mjs";import"./useKeyboard-43ff37ba.mjs";const ne={style:{height:"100%","border-right":"solid 1px white"}},oe=p("div",{style:{"border-bottom":"1px solid",height:"24px"}}," Properties ",-1),ie={style:{width:"200px",height:"100%"}},se={style:{margin:"auto 4px"}},re={style:{position:"relative",height:"calc(100% - 12px)"}},ue={style:{display:"flex",position:"relative",height:"24px","border-bottom":"1px solid"}},de={style:{position:"absolute",bottom:"0",width:"100%"}},be=H({__name:"KeyframePanel",setup(ce){const{timeline:h,updateEffect:T,update:V}=J(),{addEventListener:I}=Q(),t=C(()=>h.value.selectedStrips.length>0?h.value.selectedStrips[0]:null),s=c(new Map),M=c(new Map),L=C(()=>[...Array(Math.floor(R.value))].map((e,o)=>o)),u=c(0),m=c(1);function z(){var a;s.value.clear(),(a=t.value)==null||a.effects.forEach(l=>{"animations"in l&&l.animations.forEach(n=>{var f;s.value.has(n.key)||s.value.set(n.key,[]),M.value.set(n.id,{...l}),(f=s.value.get(n.key))==null||f.push(n)})});const e=new Map,o=[...s.value.keys()];o.sort((l,n)=>l.localeCompare(n)),o.forEach(l=>{e.set(l,s.value.get(l)||[])}),s.value=e}const b=c(null),_=c(0);function F(){var a;if(!t.value){_.value=1;return}const e=(a=b.value)==null?void 0:a.getBoundingClientRect(),o=(e==null?void 0:e.width)||0;_.value=o/t.value.length/(m.value-u.value)}function k(){F(),N()}W(k);const g=c(0);function N(){var a;if(!t.value){g.value=0;return}const e=(a=b.value)==null?void 0:a.getBoundingClientRect(),o=(e==null?void 0:e.width)||0;g.value=-o*u.value/(m.value-u.value)}const R=C(()=>t.value?t.value.length:0);B(t,()=>{z()}),B(()=>{var e;return[...((e=t.value)==null?void 0:e.effects)||[]]},()=>{z()});const K=c(null);X(()=>{var e;I("resize",k),window.addEventListener("resize",k),(e=K.value)==null||e.addEventListener("keydown",o=>{!t.value||o.key==="x"&&t.value.effects.filter(a=>{if("animations"in a){const l=[];a.animations.forEach(n=>{h.value.selectedKeyframes.forEach(f=>{n.id!==f.id&&l.push({...n})}),t.value&&T(t.value.id,{...a,animations:l})})}return!0})})});function O(e){u.value=e}function $(e){m.value=e}function j(e){!t.value||V(t.value.start+e,!0)}return(e,o)=>{const a=D,l=U,n=q,f=G;return i(t)?(r(),v("div",{key:0,ref_key:"el",ref:K,style:{display:"flex",height:"100%"}},[p("div",ne,[oe,p("div",ie,[(r(!0),v(x,null,w(s.value,(d,E)=>(r(),v("div",{key:E,style:{display:"flex",overflow:"hidden",height:"24px","white-space":"nowrap","box-sizing":"border-box","border-bottom":"1px solid var(--border-grey)"}},[p("div",se,Z(d[0])+": ",1),y(a,{style:{margin:"2px 4px 2px auto"},value:i(ee)(d[1],i(h).curent-i(t).start,d[0],0).toFixed(3),readonly:""},null,8,["value"])]))),128))])]),p("div",{ref_key:"timeArea",ref:b,style:{overflow:"hidden",position:"relative",width:"100%",height:"100%","user-select":"none"}},[p("div",re,[y(le),p("div",ue,[y(l,{start:u.value*i(t).length,length:(m.value-u.value)*i(t).length,onMove:j},null,8,["start","length"])]),y(n,{style:P({left:(i(h).curent-i(t).start-u.value*i(t).length)*_.value+"px"})},null,8,["style"]),(r(!0),v(x,null,w(i(L),d=>(r(),v("div",{key:d,style:P([{left:`${g.value+d*_.value}px`},{display:"flex",position:"absolute",height:"100%","border-left":"1px solid var(--bg2)"}])},null,4))),128)),(r(!0),v(x,null,w(s.value,(d,E)=>(r(),v("div",{key:E,style:{dislplay:"flex",position:"relative",height:"24px",width:"100%","border-bottom":"1px solid var(--bg2)","box-sizing":"border-box"}},[(r(!0),v(x,null,w(d[1],S=>{var A;return r(),te(ae,{key:S.id,animation:S,scale:_.value,left:g.value,effect:M.value.get(S.id),"strip-id":((A=i(t))==null?void 0:A.id)||""},null,8,["animation","scale","left","effect","strip-id"])}),128))]))),128))]),p("div",de,[y(f,{start:u.value,end:m.value,onStart:O,onEnd:$},null,8,["start","end"])])],512)],512)):Y("",!0)}}});export{be as default};
