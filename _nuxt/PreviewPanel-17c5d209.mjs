import w from"./VInput-96bc35a5.mjs";import y from"./PreviewGizmo-25130d2d.mjs";import{u as x}from"./useUpdate-0201ee43.mjs";import{a as S,r as u,e as k,x as $,a0 as b,a1 as n,f as P,o as R,i as z,j as o,k as h,t as B,u as F}from"./entry-c28f6d48.mjs";import{R as j}from"./Recorder-2b32c24e.mjs";import"./VIcons-d2472329.mjs";import"./mdi-4cca1244.mjs";import"./onDragStart-b67a33ef.mjs";import"./index-352be915.mjs";import"./setAnimation-30ab6762.mjs";function D(v){let e=v;e<0&&(e=-e);const d=e.toFixed(3).split(".")[1],t=new Date(e*1e3).toISOString().substr(11,8);let r="";return e<0&&(r="-"),`${r}${t}.${d}`}const I={style:{display:"flex","white-space":"nowrap"}},M=o("div",null,"Zoom :",-1),N={style:{display:"flex",height:"calc(100% - 32px)"}},U={style:{margin:"auto",position:"relative"}},V={style:{"line-height":"12px",height:"12px","text-align":"center"}},H=S({__name:"PreviewPanel",setup(v){const e=u(null),m=u(null),{addUpdate:d}=x(),{timeline:t,selectStrip:r}=k(),l=u(.2),f=u(null);$(()=>{if(!e.value||!m.value)return;f.value=new j(e.value);const a=new b({canvas:e.value}),i=t.value.width,s=t.value.height;a.setSize(i,s),n.camera.left===0&&(n.camera.left=-i/2,n.camera.right=i/2,n.camera.top=s/2,n.camera.bottom=-s/2,n.camera.near=-100,n.camera.far=1e3),d(()=>{var c;!e.value||(a.setSize(i,s),e.value.style.margin="auto",e.value.style.width=`${i*l.value}px`,e.value.style.height="",n.camera.updateProjectionMatrix(),a.render(n.scene,n.camera),t.value.isRecording&&t.value.curent>t.value.length&&((c=f.value)==null||c.stop()))})});const _=P(()=>D(t.value.curent));function g(){for(const a of t.value.strips)if(a.start<t.value.curent&&a.start+a.length>t.value.curent){if(t.value.selectedStrips.find(s=>s.id===a.id))continue;r([a.id]);break}}return(a,i)=>{const s=w,c=y;return R(),z("div",{ref_key:"el",ref:m,style:{height:"100%",width:"100%",overflow:"hidden"}},[o("div",I,[M,h(s,{value:l.value,scale:.01,step:.01,min:.1,max:1,view:p=>p.toFixed(2),onInput:i[0]||(i[0]=p=>l.value=p)},null,8,["value","scale","step","min","view"])]),o("div",N,[o("div",U,[h(c,{scale:l.value},null,8,["scale"]),o("canvas",{ref_key:"canvas",ref:e,style:{width:"100%",height:"100%",margin:"auto"},onPointerdown:g},null,544)])]),o("div",V,B(F(_)),1)],512)}}});export{H as default};
