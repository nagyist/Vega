import{p as F,a as L,e as W,r as b,f as T,o as O,i as q,c as A,v as K,j as k,z as D,u as R,P as X,a5 as Y,R as G}from"./entry-7dd23744.mjs";import{u as Q}from"./useOperation-8247599a.mjs";import{u as Z}from"./useKeyboard-957966c8.mjs";import{u as tt}from"./usePixPerSec-b2351d12.mjs";import{c as et}from"./clone-0e5b969a.mjs";import{o as E}from"./onDragStart-b67a33ef.mjs";const st=["id"],rt=L({__name:"StripUi",props:{strip:{type:Object,required:!0},top:{default:0,type:Number}},setup(P){const t=P,{timeline:l,moveStrip:o,selectStrip:w}=W(),{pushHistory:m}=Q(),{keyboard:M}=Z(),C=50,h=b(null),a=T(()=>{var e;return tt((e=h.value)==null?void 0:e.parentElement)}),y=50,g=28,_=b(0),U=T(()=>{let e=(t.strip.start-l.value.start)*a.value,s=t.strip.length*a.value;return e<-y&&(s+=e+y,e=-y),s<=g?(_.value=g-s,s=g):_.value=0,{width:s+"px",position:"absolute",top:t.strip.layer*C+1-t.top+"px",left:e+"px"}}),S=b(!1);function z(e){var c;e.preventDefault(),e.stopPropagation();const s=(c=h.value)==null?void 0:c.parentElement,i=s==null?void 0:s.getBoundingClientRect();if(!i)return;const n={start:t.strip.start,length:t.strip.length,id:t.strip.id,layer:t.strip.layer},d=n.start;let r={...n},p=l.value.selectedStrips.filter(f=>f.id!==t.strip.id);const u=p.map(f=>et(f));S.value=!0,E(e,(f,$,N)=>{l.value.selectedStrips.find(v=>v.id===t.strip.id)||(M.value.shift||(p=[]),I(t.strip)),S.value=!1;const x=Math.floor(($.clientY-i.top+t.top)/C);x<0||(r={id:n.id,layer:x,start:d+N.x/a.value,length:n.length},o(r.id,r.start,r.length,r.layer),p.forEach((v,B)=>{const j=-n.layer+u[B].layer;o(v.id,u[B].start+N.x/a.value,v.length,x+j)}))},()=>{if(S.value){I(t.strip);return}m(`MoveStrip: ${JSON.stringify(r,null,2)}`),Y.push(()=>{m(`Undo MoveStrip: ${JSON.stringify(n,null,2)}`),o(n.id,n.start,n.length,n.layer)},()=>{m(`Redo MoveStrip: ${JSON.stringify(r,null,2)}`),o(r.id,r.start,r.length,r.layer)})})}function H(e){e.stopPropagation();const s=t.strip.start+t.strip.length,i=t.strip.start,n=t.strip.length;E(e,(d,r,p)=>{const u=G(p.x/a.value),c=i+u;c>s||o(t.strip.id,c,n-u,t.strip.layer)})}function J(e){e.stopPropagation();const s=t.strip.length;E(e,(i,n,d)=>{const r=s+d.x/a.value;r<0||o(t.strip.id,t.strip.start,r)})}function V(e){for(let s=0;s<e.effects.length;s++){const i=e.effects[s];if(i.type==="Text")return"text-strip-ui";if(i.type==="Video")return"video-strip-ui";if(i.type==="Audio")return"audio-strip-ui";if(i.type==="Image")return"image-strip-ui";console.warn("unknown effect type",i.type)}}function I(e){M.value.shift?w(l.value.selectedStrips.map(s=>s.id).concat([e.id])):w([e.id])}return(e,s)=>(O(),q("div",{id:"strip-"+P.strip.id,ref_key:"el",ref:h,style:D(R(U)),class:X(["strip",R(l).selectedStrips.find(i=>i.id===t.strip.id)?"strip-selected":""]),onMousedown:z},[(O(),A(K(V(t.strip)),{strip:t.strip},null,8,["strip"])),k("div",{class:"handle",onMousedown:H},null,32),k("div",{class:"handle",style:{right:"0"},onMousedown:J},null,32),k("div",{style:D([{"background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",right:"-4px",top:"-4px",height:"49px"},{width:_.value+"px"}])},null,4)],46,st))}});var ut=F(rt,[["__scopeId","data-v-10eeb2a4"]]);export{ut as default};
