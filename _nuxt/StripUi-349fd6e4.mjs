import{p as R,a as V,e as $,r as S,f as P,o as I,i as j,c as z,v as F,j as x,C as B,u as T,L as W,a2 as q,N as A}from"./entry-c28f6d48.mjs";import{u as K}from"./useOperation-f589afb2.mjs";import{u as X}from"./useKeyboard-fa2a6ff6.mjs";import{u as Y}from"./usePixPerSec-fc9c7694.mjs";import{o as k}from"./onDragStart-b67a33ef.mjs";const G=["id"],Q=V({__name:"StripUi",props:{strip:{type:Object,required:!0},top:{default:0,type:Number}},setup(E){const t=E,{timeline:u,moveStrip:l,selectStrip:b}=$(),{pushHistory:v}=K(),{keyboard:w}=X(),C=50,m=S(null),o=P(()=>{var e;return Y((e=m.value)==null?void 0:e.parentElement)}),h=50,g=28,y=S(0),O=P(()=>{let e=(t.strip.start-u.value.start)*o.value,s=t.strip.length*o.value;return e<-h&&(s+=e+h,e=-h),s<=g?(y.value=g-s,s=g):y.value=0,{width:s+"px",position:"absolute",top:t.strip.layer*C+1-t.top+"px",left:e+"px"}}),_=S(!1);function D(e){var f;e.preventDefault(),e.stopPropagation();const s=(f=m.value)==null?void 0:f.parentElement,i=s==null?void 0:s.getBoundingClientRect();if(!i)return;const n={start:t.strip.start,length:t.strip.length,id:t.strip.id,layer:t.strip.layer};let c=n.start,r={...n},d=u.value.selectedStrips.filter(a=>a.id!==t.strip.id);d.map(a=>a.start),_.value=!0,k(e,(a,L)=>{u.value.selectedStrips.find(p=>p.id===t.strip.id)||(w.value.shift||(d=[]),M(t.strip)),_.value=!1;const N=Math.floor((L.clientY-i.top+t.top)/C);N<0||(c+=a.x/o.value,r={id:n.id,layer:N,start:c,length:n.length},l(r.id,r.start,r.length,r.layer),d.forEach(p=>{l(p.id,p.start+a.x/o.value,p.length,p.layer)}))},()=>{if(_.value){M(t.strip);return}v(`MoveStrip: ${JSON.stringify(r,null,2)}`),q.push(()=>{v(`Undo MoveStrip: ${JSON.stringify(n,null,2)}`),l(n.id,n.start,n.length,n.layer)},()=>{v(`Redo MoveStrip: ${JSON.stringify(r,null,2)}`),l(r.id,r.start,r.length,r.layer)})})}function U(e){e.stopPropagation();const s=t.strip.start+t.strip.length,i=t.strip.start,n=t.strip.length;k(e,(c,r,d)=>{const f=A(d.x/o.value),a=i+f;a>s||l(t.strip.id,a,n-f,t.strip.layer)})}function H(e){e.stopPropagation();const s=t.strip.length;k(e,(i,n,c)=>{const r=s+c.x/o.value;r<0||l(t.strip.id,t.strip.start,r)})}function J(e){for(let s=0;s<e.effects.length;s++){const i=e.effects[s];if(i.type==="Text")return"panels-text-strip-ui";if(i.type==="Video")return"panels-video-strip-ui";if(i.type==="Audio")return"panels-audio-strip-ui";if(i.type==="Image")return"panels-image-strip-ui";console.warn("unknown effect type",i.type)}}function M(e){w.value.shift?b(u.value.selectedStrips.map(s=>s.id).concat([e.id])):b([e.id])}return(e,s)=>(I(),j("div",{id:"strip-"+E.strip.id,ref_key:"el",ref:m,style:B(T(O)),class:W(["strip",T(u).selectedStrips.find(i=>i.id===t.strip.id)?"strip-selected":""]),onMousedown:D},[(I(),z(F(J(t.strip)),{strip:t.strip},null,8,["strip"])),x("div",{class:"handle",onMousedown:U},null,32),x("div",{class:"handle",style:{right:"0"},onMousedown:H},null,32),x("div",{style:B([{"background-color":"rgba(0, 0, 0, 0.5)",position:"absolute",right:"-4px",top:"-4px",height:"49px"},{width:y.value+"px"}])},null,4)],46,G))}});var it=R(Q,[["__scopeId","data-v-6992710c"]]);export{it as default};
